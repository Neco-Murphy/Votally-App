"use strict";angular.module("App",["ionic","App.Home","App.Login","App.Pending","App.Receivers","App.Results","App.Settings","App.Signup","App.ServerRequests","App.ServerRoutes","App.Auth","App.Camera","App.Directives","App.ReceiversFactory"]).run(function(a,b,c,d){a.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),window.StatusBar&&StatusBar.styleDefault()}),b.$on("$stateChangeSuccess",function(a,b){b.authenticate&&!d.isAuth()&&(c.transitionTo("tab.account"),a.preventDefault())})}).config(function(a,b,c){a.imgSrcSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|tel):/),b.state("home",{url:"/",views:{"":{templateUrl:"js/views/home/homeTemplate.html",controller:"HomeController"}},authenticate:!0}).state("loading",{url:"/loading",views:{"view-loading":{templateUrl:"js/views/loading/loadingTemplate.html",controller:"LoadingController"}},authenticate:!0}).state("login",{url:"/login",views:{"":{templateUrl:"js/views/login/loginTemplate.html",controller:"LoginController"}}}).state("pending",{url:"/pending",views:{"":{templateUrl:"js/views/pending/pendingTemplate.html",controller:"PendingController"}}}).state("receivers",{url:"/receivers",views:{"":{templateUrl:"js/views/receivers/receiversTemplate.html",controller:"ReceiversController"}},authenticate:!0}).state("results",{url:"/results",views:{"":{templateUrl:"js/views/results/resultsTemplate.html",controller:"ResultsController"}}}).state("settings",{url:"/settings",views:{"":{templateUrl:"js/views/settings/settingsTemplate.html",controller:"SettingsController"}}}).state("signup",{url:"/signup",views:{"":{templateUrl:"js/views/signup/signupTemplate.html",controller:"SignupController"}}}),c.otherwise("/")}),angular.module("App.Directives",[]).directive("setImage",function(){return{restrict:"A",scope:{image:"="},link:function(a,b){a.$watch("image",function(){b.attr("src",a.image)})}}}).directive("compareInput",function(){return{require:"ngModel",scope:{otherModelValue:"=compareInput"},link:function(a,b,c,d){d.$validators.compareInput=function(b){return b==a.otherModelValue},a.$watch("otherModelValue",function(){d.$validate()})}}}),angular.module("App.Auth",[]).factory("Auth",function(a,b,c){var d=function(b,c){return a({method:"POST",url:c,data:b}).then(function(a){return a.data}).catch(function(a){console.error(a)})},e=function(a,b){var e={username:a,password:b};return d(e,"/user/login").then(function(a){return a.error?a.error:(c.localStorage.setItem("loggedIn",!0),c.localStorage.setItem("userId",a.userId),c.localStorage.setItem("token",a.token),void 0)}).catch(function(a){console.log(a)})},f=function(a,b,e){var f={username:a,password:b,email:e};return d(f,"/user/signup").then(function(a){return a.error?a.error:(c.localStorage.setItem("loggedIn",!0),c.localStorage.setItem("userId",a.userId),c.localStorage.setItem("token",a.token),void 0)}).catch(function(a){console.log(a)})},g=function(){return!!c.localStorage.getItem("loggedIn")},h=function(a){d({userId:a},"/user/logout").then(function(){c.localStorage.setItem("loggedIn",!1),c.localStorage.setItem("userId",void 0),c.localStorage.setItem("token",void 0),b.path("/login")}).catch(function(a){console.log("Unable to logout: ",a)})};return{login:e,signup:f,loggedIn:g,logout:h}}),angular.module("App.Camera",[]).factory("Camera",function(a){var b={quality:100,saveToPhotoAlbum:!1,destinationType:0},c={quality:100,saveToPhotoAlbum:!1,destinationType:0,sourceType:0},d=function(a){return"takePicture"===a?b:"uploadPicture"===a?c:void 0};return{getPicture:function(b){var c=a.defer();return navigator.camera.getPicture(function(a){c.resolve(a)},function(a){c.reject(a)},d(b)),c.promise}}}),angular.module("App.ReceiversFactory",[]).factory("ReceiversFactory",function(){var a={},b={};return{contentFromHome:function(b){a=b},addReceivers:function(c){return b.receivers=c,b.content=a,b},resetContentFromHome:function(){a={}}}}),angular.module("App.ServerRequests",[]).factory("ServerRequests",function(a){var b=function(b){return a({method:"GET",url:b}).then(function(a){return a.data})},c=function(b,c){return a({method:"POST",url:c,data:b}).then(function(a){return a.data})};return{get:b,post:c}}),angular.module("App.ServerRoutes",[]).factory("ServerRoutes",function(){return{sendContent:"/receivers/sendContent",getPending:"/pending/getPending",sendVote:"/pending/sendVote",getResults:"/results/getResults",getReceivers:"/receivers/getContacts",postContent:"/receivers/sendContent"}}),angular.module("App.Home",[]).config(function(a){a.imgSrcSanitizationWhitelist(/^\s*(https?|blob|cdvfile|content|ftp|mailto|file|tel):|data:image\//)}).controller("HomeController",function(a,b,c,d,e,f){a.content={topic:"",picture:"",userId:0},a.swiping=function(a){"left"===a&&b.path("/results"),"right"===a&&b.path("/pending")},a.send=function(){(""!==a.content.topic||""!==a.content.picture)&&(d.contentFromHome(a.content),b.path("/receivers"))},a.addText=function(b){a.content.topic=b},a.getPhoto=function(b){f.getPicture(b).then(function(b){a.content.picture="data:image/jpeg;base64,"+b,document.getElementById("myImage").src=a.content.picture},function(a){alert(a)},b)}}),angular.module("App.Login",[]).controller("LoginController",function(a,b,c,d){a.usernameInput,a.passwordInput,a.showLoginError=!1,a.logIn=function(b,e){d.login(b,e).then(function(d){d?(a.showLoginError=!0,a.loginError=d):(console.log("login as ",b,e),c.path("/"))})},a.signUp=function(){c.path("/signup")}}),angular.module("App.Pending",[]).controller("PendingController",function(a,b,c,d,e){var f,g,h=function(b){console.log("setting up to show the content ..."),f=b.contentId,a.topic=b.topic,a.sender=b.username,a.pictureUrl=b.data},i=function(){g&&0!==g.length?h(g[0]):c.path("/")},j=b.localStorage.getItem("userId"),k=function(){d.post({userId:j},e.getPending).then(function(a){g=a.contents,i()}).catch(function(a){console.error(a)})};k(),a.sendVote=function(a){var b={userId:j,contentId:f,vote:a};d.post(b,e.sendVote).then(function(){g.shift(),i()}).catch(function(a){console.error(a)})}}),describe("PendingController",function(){it("Module should exist",function(){expect(!0).toBe(!0)});var a,b,c,d;beforeEach(module("App")),beforeEach(inject(function(e){b=e.get("$rootScope"),$httpBackend=e.get("$httpBackend"),c=e.get("ServerRequests"),d=e.get("ServerRoutes"),a=b.$new();var f=e.get("$controller");(createController=function(){return f("PendingController",{$scope:a,ServerRequests:c,ServerRoutes:d})})()}));var e={pendingContents:[{contentId:1,topic:"This owl beanie for Rich?",picture:"owl-beanie",userId:100,userName:"Teresa"},{contentId:2,topic:"for lunch?",picture:"turtle-burger",userId:200,userName:"Bace"},{contentId:3,topic:"still grumpy?",picture:"http://i.imgur.com/Cxagv.jpg",userId:300,userName:"Rich"}]};it("should call checkPending() when controller is loaded",function(){$httpBackend.expectPOST("someRoute").respond(e),$httpBackend.flush(),expect(a.pendingList).to.eql(e.pendingContents)}),it("should have a sendVote method on the $scope",function(){expect(a.sendVote).to.be.a("function")})}),angular.module("App.Receivers",[]).controller("ReceiversController",function(a,b,c,d,e){var f=[{name:"Teresa",userId:12345},{name:"Satoko",userId:67894},{name:"Rich",userId:23456},{name:"bace",userId:24689},{name:"Bogut",userId:54711}];a.cancelSend=function(){c.resetContentFromHome(),b.path("/")},a.setReceivers=function(){for(var f in a.viewSelectedReceivers)a.modelSelectedReceivers.push(f);var g=c.addReceivers(a.modelSelectedReceivers);d.post(g,e.postContent),c.resetContentFromHome(),b.path("/")},a.allReceivers=f,a.modelSelectedReceivers=[],a.viewSelectedReceivers={},a.select=function(b){a.viewSelectedReceivers[b.userId]?delete a.viewSelectedReceivers[b.userId]:a.viewSelectedReceivers[b.userId]=b.name},a.isSelected=function(b){return!!a.viewSelectedReceivers[b.userId]}}),angular.module("App.Results",[]).controller("ResultsController",function(a,b,c,d,e,f){console.log("are you in controller?");var g=b.localStorage.getItem("userId");d.loggedIn()?c.path("/login"):e.post({userId:g},f.getResults).then(function(b){a.results=[];for(var c=b.length-1;c>=0;c--)a.results.push(b[c])}),a.routeToHome=function(){console.log("are you at home"),c.path("/")},a.routeToSettings=function(){c.path("/settings")}}),angular.module("App.Settings",[]).controller("SettingsController",function(a,b,c,d){var e=b.localStorage.getItem("userId");d.loggedIn()?(a.logout=function(){d.logout(e)},a.routeToResults=function(){c.path("/results")}):c.path("/login")}),angular.module("App.Signup",[]).controller("SignupController",function(a,b,c,d){a.usernameInput,a.passwordInput,a.emailInput,a.showSignupError=!1,a.signupError,a.signUp=function(b,e,f){d.signup(b,e,f).then(function(d){d?(a.showSignupError=!0,a.signupError=d):(console.log("siginup and login as",b,e),c.path("/"))})}});